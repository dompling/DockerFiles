
FROM alpine

RUN apk update
RUN apk add --no-cache --virtual .build-deps \
    ca-certificates \
    curl \
    tzdata \
    git \
    nodejs \
    npm \
    nginx\
    && mkdir /git \
    && mkdir /docker \
    && mkdir /Sub-Store \
    && mkdir /Sub-Store/nginx \
    && npm install -g cnpm pm2

COPY /Sub-Store/sub-store.sh /Sub-Store/
COPY /Sub-Store/nginx/nginx.conf /etc/nginx/
COPY /Sub-Store/nginx/front.conf /Sub-Store/nginx/conf.d/
COPY /Sub-Store/nginx/front.template /Sub-Store/nginx/conf.d/

RUN chmod +x /usr/local/bin/sub-store.sh

ENV GIT="https://github.com/Peng-YM/Sub-Store.git"
ENV DOMAIN="/"
ENV ALLOW_IP=""

WORKDIR /Sub-Store

RUN git clone ${GIT} /git

ENTRYPOINT [ "/Sub-Store/sub-store.sh" ]