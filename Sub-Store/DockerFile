
FROM alpine

RUN apk update
RUN apk add --no-cache --virtual .build-deps \
    ca-certificates \
    curl \
    tzdata \
    git \
    nodejs \
    npm \
    nginx\
    gettext\
    && mkdir /git \
    && mkdir /docker \
    && mkdir /Sub-Store \
    && mkdir /Sub-Store/nginx \
    && npm install -g cnpm pm2



ENV GIT="https://github.com/Peng-YM/Sub-Store.git"
ENV DOCKER="https://github.com/dompling/DockerFiles.git"
ENV DOMAIN="/"
ENV ALLOW_IP=""
ENV TZ=Asia/Shanghai

WORKDIR /Sub-Store

RUN git clone ${GIT} /git\
    && git clone ${DOCKER} /docker\
    && cd /git/backend \
    && cp -r /git/web /Sub-Store/ \
    && cp -r /git/backend /Sub-Store/ \
    && cd /Sub-Store/backend \
    && cnpm install \
    && cd /Sub-Store/web \
    && cnpm install

RUN chmod 777 /docker/Sub-Store/sub-store.sh

ENTRYPOINT ["/bin/sh","/docker/Sub-Store/sub-store.sh" ]